<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>more examples · PhyloCoalSimulations.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://cecileane.github.io/PhyloCoalSimulations.jl/man/more_examples/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PhyloCoalSimulations.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">home</a></li><li><span class="tocitem">manual</span><ul><li><a class="tocitem" href="../getting_started/">getting started</a></li><li><a class="tocitem" href="../mapping_genetree_to_network/">mapping gene trees into the species network</a></li><li><a class="tocitem" href="../converting_coal2generation_units/">converting between units</a></li><li class="is-active"><a class="tocitem" href>more examples</a><ul class="internal"><li><a class="tocitem" href="#counting-deep-coalescences"><span>counting deep coalescences</span></a></li><li><a class="tocitem" href="#number-of-lineages-inherited-via-gene-flow"><span>number of lineages inherited via gene flow</span></a></li><li><a class="tocitem" href="#rate-variation-across-species"><span>rate variation across species</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">manual</a></li><li class="is-active"><a href>more examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>more examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/cecileane/PhyloCoalSimulations.jl/blob/main/docs/src/man/more_examples.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="example-uses"><a class="docs-heading-anchor" href="#example-uses">example uses</a><a id="example-uses-1"></a><a class="docs-heading-anchor-permalink" href="#example-uses" title="Permalink"></a></h1><p>We are re-using the same network and simulated tree as before:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; writeTopology(net)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;((C:0.9,(B:0.2)#H1:0.7::0.6)I1:0.6,(#H1:0.6::0.4,A:1.0)I2:0.5)I3;&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; writeTopology(tree, round=true)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;((((C:0.9)I1:0.6)I3:0.64,((A:1.0)I2:0.5)I3:0.64):1.424,(((B:0.2)H1:0.6)I2:0.5)I3:2.064);&quot;</code></pre><p><img src="../../assets/figures/genetree_example1.svg" alt="example 1, same as in mapping section"/></p><h2 id="counting-deep-coalescences"><a class="docs-heading-anchor" href="#counting-deep-coalescences">counting deep coalescences</a><a id="counting-deep-coalescences-1"></a><a class="docs-heading-anchor-permalink" href="#counting-deep-coalescences" title="Permalink"></a></h2><p>The number of deep coalescences can be quantified as the number of &quot;extra&quot; lineages due to incomplete lineage sorting, that can be calculated from embedding the gene tree into the species phylogeny (see <a href="https://doi.org/10.1093/sysbio/46.3.523">Maddison 1997</a> for species trees). For a speciation node in the species tree (e.g. I1), there are extra lineages in the gene tree, owing to a lack of coalescence, if there are more than 2 gene lineages mapping to this speciation node. For each hybridization node (e.g. H1), there are extra lineages if there are more than 1 gene lineage mapping to this hybridization node (because there&#39;s only 1 child edge descending from a hybridization node).</p><p>We can count the number of extra lineages by counting the number of degree-2 nodes in the gene tree mapping to each node in the species network, then counting how many are &quot;extra&quot;. In our gene tree above, we can do it this way:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; node_count = Dict(n.name =&gt; 0      for n in net.node if !n.leaf) # ignore leaves</code><code class="nohighlight hljs ansi" style="display:block;">Dict{String, Int64} with 4 entries:
  &quot;H1&quot; =&gt; 0
  &quot;I1&quot; =&gt; 0
  &quot;I2&quot; =&gt; 0
  &quot;I3&quot; =&gt; 0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; node_hyb = Dict(n.name =&gt; n.hybrid for n in net.node if !n.leaf) # true/1 for hybrid nodes</code><code class="nohighlight hljs ansi" style="display:block;">Dict{String, Bool} with 4 entries:
  &quot;H1&quot; =&gt; 1
  &quot;I1&quot; =&gt; 0
  &quot;I2&quot; =&gt; 0
  &quot;I3&quot; =&gt; 0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # traverse the gene tree, to count number of lineages entering each network node
       for n in tree.node
         (n.leaf || n.name == &quot;&quot;) &amp;&amp; continue # skip leaves and nodes without a name
         node_count[n.name] += 1  # increment by 1 the number of lineages entering this node
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; node_count # the 2 lineages entering I2 didn&#39;t coalesce until they reached I3</code><code class="nohighlight hljs ansi" style="display:block;">Dict{String, Int64} with 4 entries:
  &quot;H1&quot; =&gt; 1
  &quot;I1&quot; =&gt; 1
  &quot;I2&quot; =&gt; 2
  &quot;I3&quot; =&gt; 3</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; for node in keys(node_count) # modify our counts, to only keep the extras
         node_count[node] = max(0, node_count[node] - ( node_hyb[node] ? 1 : 2))
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; node_count # number of extra lineages: 1 extra entering I3</code><code class="nohighlight hljs ansi" style="display:block;">Dict{String, Int64} with 4 entries:
  &quot;H1&quot; =&gt; 0
  &quot;I1&quot; =&gt; 0
  &quot;I2&quot; =&gt; 0
  &quot;I3&quot; =&gt; 1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; deepcoalescence = sum(values(node_count))</code><code class="nohighlight hljs ansi" style="display:block;">1</code></pre><p>On the particular gene tree we simulated, we counted 1 deep coalescence.</p><h2 id="number-of-lineages-inherited-via-gene-flow"><a class="docs-heading-anchor" href="#number-of-lineages-inherited-via-gene-flow">number of lineages inherited via gene flow</a><a id="number-of-lineages-inherited-via-gene-flow-1"></a><a class="docs-heading-anchor-permalink" href="#number-of-lineages-inherited-via-gene-flow" title="Permalink"></a></h2><p>Our network has inheritance γ=0.4 on the minor edge, which we&#39;ll call the &quot;gene flow&quot; edge, and γ=0.6 on the major hybrid edge, parent to H1 on the major tree. But we may be interested in the realized proportion of lineages inherited from each parent at H1, realized in the gene trees we actually simulated. To do so, we can count the number of gene lineages that are mapped to each hybrid edge in the network.</p><p>This mapping is stored in the edge attribute <code>.inCycle</code>. From the plot above, the minor &quot;gene flow&quot; edge is edge number 5 and the major hybrid edge has number 3. So we can count the gene lineages inherited via gene flow as the number of gene tree edges with <code>inCycle</code> equal to 5.</p><p>If the gene trees have been saved to a file and later read from this file, then the <code>.inCycle</code> attributes are no longer stored in memory. In this case, we can retrieve the mapping information by the internal node names. The edges going through gene flow are those whose child node is named &quot;H1&quot; and parent node is named &quot;I2&quot;.</p><p>We use the first option with the <code>.inCycle</code> attribute below. We get that our one simulated gene tree was indeed inherited via gene flow:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; sum(e.inCycle == 5 for e in tree.edge)</code><code class="nohighlight hljs ansi" style="display:block;">1</code></pre><p>To make this more interesting, we can simulate many gene trees then count how many of their lineages were inherited via gene flow. If we ask for 2 individuals in species B, then each gene may have 2 lineages that enter the hybrid node H1, if the two B individuals fail to coalesce. In that case, it&#39;s possible that one individual lineage was inherited via gene flow, and the other not. We&#39;ll calculate the gene flow proportion among all these lineages. This proportion should be close (but not exactly equal) to the theoretical γ=0.4 from the network model.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; ngenes = 100</code><code class="nohighlight hljs ansi" style="display:block;">100</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; genetrees = simulatecoalescent(net, ngenes, Dict(&quot;B&quot;=&gt;2, &quot;A&quot;=&gt;1, &quot;C&quot;=&gt;1); nodemapping=true);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; length(genetrees)</code><code class="nohighlight hljs ansi" style="display:block;">100</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; nlineages_geneflow = sum(sum(e.inCycle == 5 for e in gt.edge) for gt in genetrees)</code><code class="nohighlight hljs ansi" style="display:block;">70</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; nlineages_major    = sum(sum(e.inCycle == 3 for e in gt.edge) for gt in genetrees)</code><code class="nohighlight hljs ansi" style="display:block;">129</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # realized γ, close to 0.4:
       proportion_geneflow = nlineages_geneflow / (nlineages_geneflow + nlineages_major)</code><code class="nohighlight hljs ansi" style="display:block;">0.35175879396984927</code></pre><h2 id="rate-variation-across-species"><a class="docs-heading-anchor" href="#rate-variation-across-species">rate variation across species</a><a id="rate-variation-across-species-1"></a><a class="docs-heading-anchor-permalink" href="#rate-variation-across-species" title="Permalink"></a></h2><p>The gene trees resulting from <code>simulatecoalescent</code> have their edge lengths in coalescent units. One may want to convert them to substitutions per site, so as to simulate molecular sequences along these gene trees. The mapping information is important to allow for different rates of molecular evolution across different species. Here is an example to do this.</p><p>We will use the <code>Distributions</code> package to simulate rates from a log-normal distribution across species, that is, across edges in the species network.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Distributions</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; lognormal_rate_dist = LogNormal(-0.125, 0.5) # μ = -σ²/2 to get a mean of 1.</code><code class="nohighlight hljs ansi" style="display:block;">Distributions.LogNormal{Float64}(μ=-0.125, σ=0.5)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; networkedge_rate = Dict(e.number =&gt; rand(lognormal_rate_dist) for e in net.edge)</code><code class="nohighlight hljs ansi" style="display:block;">Dict{Int64, Float64} with 7 entries:
  5 =&gt; 0.68631
  4 =&gt; 1.23458
  6 =&gt; 1.84251
  7 =&gt; 0.438
  2 =&gt; 1.43724
  3 =&gt; 1.09321
  1 =&gt; 0.580741</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # add entry for the edge above the network&#39;s root. Find its number first.
       rootedgenumber = PhyloCoalSimulations.get_rootedgenumber(net)</code><code class="nohighlight hljs ansi" style="display:block;">8</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; push!(networkedge_rate, rootedgenumber =&gt; rand(lognormal_rate_dist))</code><code class="nohighlight hljs ansi" style="display:block;">Dict{Int64, Float64} with 8 entries:
  5 =&gt; 0.68631
  4 =&gt; 1.23458
  6 =&gt; 1.84251
  7 =&gt; 0.438
  2 =&gt; 1.43724
  8 =&gt; 1.39978
  3 =&gt; 1.09321
  1 =&gt; 0.580741</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; writeTopology(tree, round=true, digits=4) # before rate variation</code><code class="nohighlight hljs ansi" style="display:block;">&quot;((((C:0.9)I1:0.6)I3:0.64,((A:1.0)I2:0.5)I3:0.64):1.4235,(((B:0.2)H1:0.6)I2:0.5)I3:2.0636);&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # multiply the length of each gene lineage by the rate of the species edge it maps into
       for e in tree.edge
         e.length *= networkedge_rate[e.inCycle]
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; writeTopology(tree, round=true, digits=4) # after rate variation</code><code class="nohighlight hljs ansi" style="display:block;">&quot;((((C:0.5227)I1:0.7407)I3:0.8959,((A:1.8425)I2:0.219)I3:0.8959):1.9926,(((B:0.2874)H1:0.4118)I2:0.219)I3:2.8885);&quot;</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../converting_coal2generation_units/">« converting between units</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Monday 22 August 2022 22:28">Monday 22 August 2022</span>. Using Julia version 1.8.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
