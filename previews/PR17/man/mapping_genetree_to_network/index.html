<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>mapping gene trees into the species network · PhyloCoalSimulations.jl</title><meta name="title" content="mapping gene trees into the species network · PhyloCoalSimulations.jl"/><meta property="og:title" content="mapping gene trees into the species network · PhyloCoalSimulations.jl"/><meta property="twitter:title" content="mapping gene trees into the species network · PhyloCoalSimulations.jl"/><meta name="description" content="Documentation for PhyloCoalSimulations.jl."/><meta property="og:description" content="Documentation for PhyloCoalSimulations.jl."/><meta property="twitter:description" content="Documentation for PhyloCoalSimulations.jl."/><meta property="og:url" content="https://juliaphylo.github.io/PhyloCoalSimulations.jl/stable/man/mapping_genetree_to_network/"/><meta property="twitter:url" content="https://juliaphylo.github.io/PhyloCoalSimulations.jl/stable/man/mapping_genetree_to_network/"/><link rel="canonical" href="https://juliaphylo.github.io/PhyloCoalSimulations.jl/stable/man/mapping_genetree_to_network/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PhyloCoalSimulations.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">home</a></li><li><span class="tocitem">manual</span><ul><li><a class="tocitem" href="../getting_started/">getting started</a></li><li class="is-active"><a class="tocitem" href>mapping gene trees into the species network</a><ul class="internal"><li><a class="tocitem" href="#naming-internal-nodes"><span>naming internal nodes</span></a></li><li><a class="tocitem" href="#mapping-gene-tree-edges-back-into-species-edges"><span>mapping gene tree edges back into species edges</span></a></li><li><a class="tocitem" href="#cleaning-gene-trees"><span>cleaning gene trees</span></a></li></ul></li><li><a class="tocitem" href="../converting_coal2generation_units/">converting between units</a></li><li><a class="tocitem" href="../correlated_inheritance/">correlated inheritance</a></li><li><a class="tocitem" href="../more_examples/">more examples</a></li></ul></li><li><span class="tocitem">library</span><ul><li><a class="tocitem" href="../../lib/public/">public</a></li><li><a class="tocitem" href="../../lib/internal/">internals</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">manual</a></li><li class="is-active"><a href>mapping gene trees into the species network</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>mapping gene trees into the species network</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaPhylo/PhyloCoalSimulations.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaPhylo/PhyloCoalSimulations.jl/blob/main/docs/src/man/mapping_genetree_to_network.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="mapping-gene-trees-into-the-species-phylogeny"><a class="docs-heading-anchor" href="#mapping-gene-trees-into-the-species-phylogeny">mapping gene trees into the species phylogeny</a><a id="mapping-gene-trees-into-the-species-phylogeny-1"></a><a class="docs-heading-anchor-permalink" href="#mapping-gene-trees-into-the-species-phylogeny" title="Permalink"></a></h1><p>Nodes in gene trees can be mapped to a node or an edge in the species phylogeny. Edges in gene trees can be mapped to an edge in the species phylogeny. Attributes of nodes and edges are used to carry this mapping information, as detailed in the documentation of function <a href="../../lib/public/#PhyloCoalSimulations.simulatecoalescent-Tuple{PhyloNetworks.HybridNetwork, Vararg{Any}}"><code>simulatecoalescent</code></a>.</p><p>We give examples below of how we may use this mapping information.</p><h2 id="naming-internal-nodes"><a class="docs-heading-anchor" href="#naming-internal-nodes">naming internal nodes</a><a id="naming-internal-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#naming-internal-nodes" title="Permalink"></a></h2><p>First, it&#39;s useful to name internal nodes in the network, to which we can later map nodes in the gene tree.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; net = readnewick(&quot;((C:0.9,(B:0.2)#H1:0.7::0.6):0.6,(#H1:0.6,A:1):0.5);&quot;);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; nameinternalnodes!(net); # default prefix &quot;i&quot; to name internal nodes</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; writenewick(net)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;((C:0.9,(B:0.2)#H1:0.7::0.6)i1:0.6,(#H1:0.6::0.4,A:1.0)i2:0.5)i3;&quot;</code></pre><p>Notice the extra node names in the species phylogeny: i1, i2, and i3 at the root.</p><p>Next, we use the option <code>nodemapping=true</code> when simulating gene trees, to ask for extra degree-2 nodes in gene trees. These nodes are created each time that a gene tree lineage crosses a node in the species phylogeny, that is, each time that a gene tree lineage crosses a speciation node or a hybridization node. We&#39;ll simulate a single tree here each time.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using StableRNGs; rng = StableRNG(7); # to replicate randomness, but default RNG is better</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; tree_regular = simulatecoalescent(rng, net,1,1)[1];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; writenewick(tree_regular, round=true) # regular nodes only</code><code class="nohighlight hljs ansi" style="display:block;">&quot;(B:2.474,(C:1.695,A:1.695):0.979);&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; rng = StableRNG(7); # to replicate the same coalescent simulation</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; tree = simulatecoalescent(rng, net,1,1; nodemapping=true)[1];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; writenewick(tree, round=true) # extra degree-2 nodes for mapping</code><code class="nohighlight hljs ansi" style="display:block;">&quot;((((B:0.2)H1:0.6)i2:0.5)i3:1.174,(((C:0.9)i1:0.6)i3:0.195,((A:1.0)i2:0.5)i3:0.195):0.979);&quot;</code></pre><p>Notice that regular nodes in the gene tree (nodes that we get without the <code>nodemapping</code> option) don&#39;t have names. With the <code>nodemapping</code> option, there are many new nodes, all of degree-2, named after internal nodes in the network (i1, i2, i3). These extra degree-2 nodes and their names are sufficient to map the gene tree into the species network.</p><p>The network is shown on the left below, with edges annotated by their numbers.</p><pre><code class="language-julia hljs">plot(net, showedgenumber=true, shownodelabel=true, tipoffset=0.1);
plot(tree, edgelabel=DataFrame(number=[e.number for e in tree.edge],
                               label=[e.inte1 for e in tree.edge]),
           edgelabelcolor=&quot;red4&quot;, shownodelabel=true, tipoffset=0.1);</code></pre><p><img src="../../assets/figures/genetree_example1.svg" alt="example 1: degree-2 node names in gene tree"/></p><p>In the gene tree (right), each lineage is annotated by the network edge it maps into. Degree-2 nodes appear via their names, such that each horizontal line represents a series of gene lineages, separated from each other by degree-2 nodes. For example, the horizontal line tracing B&#39;s ancestry back in time maps into the network like this:</p><ul><li>from B, go back along edge 2</li><li>meet hybrid node H1, was inherited from the minor hybrid edge 5,</li><li>from speciation node i2, trace back along edge 7,</li><li>meet the network&#39;s root node i3, trace back along the network&#39;s root edge 8 before coalescing with the ancestor of the other lineages (which have already coalesced by then).</li></ul><h2 id="mapping-gene-tree-edges-back-into-species-edges"><a class="docs-heading-anchor" href="#mapping-gene-tree-edges-back-into-species-edges">mapping gene tree edges back into species edges</a><a id="mapping-gene-tree-edges-back-into-species-edges-1"></a><a class="docs-heading-anchor-permalink" href="#mapping-gene-tree-edges-back-into-species-edges" title="Permalink"></a></h2><p>When the <code>nodemapping</code> argument is used, the mapping of a gene tree within a species phylogeny is fully contained within the newick string of the gene tree. This mapping is encoded with the degree-2 node names as mentioned above. Gene trees from <code>simulatecoalescent</code> also store the mapping for species edges in the <code>inte1</code> field of gene tree edges. This information is &#39;lost&#39; when a gene tree is written in newick format. However, we can re-encode this information with <code>gene_edgemapping!</code>. We can see an example of re-encoding using the gene tree and network from above. Let&#39;s focus, for example, on the edge that the hybrid lineage inherited from, whose child node has name &quot;H1&quot;</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; e_index = findfirst(e -&gt; getchild(e).name == &quot;H1&quot;, tree.edge)</code><code class="nohighlight hljs ansi" style="display:block;">3</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; e = tree.edge[e_index]</code><code class="nohighlight hljs ansi" style="display:block;">PhyloNetworks.EdgeT{PhyloNetworks.Node}:
 number:3
 length:0.6
 attached to 2 node(s) (parent first): 6 3</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; population_mappedto(e) # edge &#39;e&#39; evolved within edge 5 in the species network</code><code class="nohighlight hljs ansi" style="display:block;">5</code></pre><p>Next we write our gene tree and read it back from the newick string, see that the mapping of edges was &quot;lost&quot;, and how to recover it using <a href="../../lib/public/#PhyloCoalSimulations.gene_edgemapping!"><code>gene_edgemapping!</code></a>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; tree_newick = writeTopology(tree)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;((((B:0.2)H1:0.6)i2:0.5)i3:1.1743591500426886,(((C:0.9)i1:0.6)i3:0.19502681753734125,((A:1.0)i2:0.5)i3:0.19502681753734125):0.9793323325053473);&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; tree = readTopology(tree_newick); # read the tree back from the newick string
       # next: find the edge above H1, as before</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; e_index = findfirst(e -&gt; getchild(e).name == &quot;H1&quot;, tree.edge) # may have changed</code><code class="nohighlight hljs ansi" style="display:block;">2</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; e = tree.edge[e_index]</code><code class="nohighlight hljs ansi" style="display:block;">PhyloNetworks.EdgeT{PhyloNetworks.Node}:
 number:2
 length:0.6
 attached to 2 node(s) (parent first): 3 2</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; population_mappedto(e) # nothing: edge mapping was &quot;lost&quot;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; gene_edgemapping!(tree, net)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; population_mappedto(e) # edge 5 in the species network: the mapping was recovered</code><code class="nohighlight hljs ansi" style="display:block;">5</code></pre><h2 id="cleaning-gene-trees"><a class="docs-heading-anchor" href="#cleaning-gene-trees">cleaning gene trees</a><a id="cleaning-gene-trees-1"></a><a class="docs-heading-anchor-permalink" href="#cleaning-gene-trees" title="Permalink"></a></h2><p>Almost all examples below use this mapping information via the extra degree-2 nodes and the extra edges between these nodes.</p><p>But we may want to &quot;clean&quot; gene trees of their degree-2 nodes at some point. This can be done with the <code>PhyloNetworks</code> utility <code>removedegree2nodes!</code>, like this:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; removedegree2nodes!(tree, true)</code><code class="nohighlight hljs ansi" style="display:block;">PhyloNetworks.HybridNetwork, Rooted Network
4 edges
5 nodes: 3 tips, 0 hybrid nodes, 2 internal tree nodes.
tip labels: B, C, A
((C:1.695,A:1.695):0.979,B:2.474);</code></pre><p>The option <code>true</code> is to keep the root, even if it&#39;s of degree 2.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../getting_started/">« getting started</a><a class="docs-footer-nextpage" href="../converting_coal2generation_units/">converting between units »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 11 December 2024 21:24">Wednesday 11 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
